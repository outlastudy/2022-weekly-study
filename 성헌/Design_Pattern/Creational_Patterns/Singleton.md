# ì‹±ê¸€í†¤ íŒ¨í„´(Singleton Pattern)

## ì‹±ê¸€í†¤ íŒ¨í„´ì´ë€?

ì „ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ì˜¤ì§ 1ê°œë§Œ ìƒì„±ë˜ëŠ” íŒ¨í„´ìœ¼ë¡œ ìƒì„±ëœ ê°ì²´ë¥¼ ì–´ë””ì—ì„œë“ ì§€ ì°¸ì¡°í•˜ë„ë¡ í•˜ëŠ” íŒ¨í„´ì´ë‹¤.

í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œì„ ìƒì„±í•˜ëŠ” ì±…ì„ì´ ìˆê³  getInstance ë©”ì„œë“œë¥¼ í†µí•´ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ì‘ì—…ì„ í•œë‹¤.

## ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

í•œë²ˆì˜ new ì—°ì‚°ìë¥¼ í†µí•´ ê³ ì •ëœ ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì‚¬ìš©í•˜ê¸°ì— ì¶”í›„ í•´ë‹¹ ê°ì²´ì— ì ‘ê·¼ ì‹œ ë©”ëª¨ë¦¬ ë‚­ë¹„ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤. ë˜í•œ ì´ë¯¸ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™œìš©í•˜ê¸°ì— ì†ë„ ì¸¡ë©´ì—ì„œë„ ì´ì ì´ ìˆë‹¤. (ë‘ ë²ˆì§¸ ì´ìš©ë¶€í„° ê°ì²´ ë¡œë”© ì‹œê°„ì´ ì¤„ì–´ë“¦)

ë˜í•œ ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ì „ì—­ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì´ê¸°ì— ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë“¤ì´ ì ‘ê·¼í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ í´ë˜ìŠ¤ ê°„ ë°ì´í„° ê³µìœ ê°€ ì‰½ë‹¤. í•˜ì§€ë§Œ ì—¬ëŸ¬ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ ë°ì´í„°ì— ë™ì‹œ ì ‘ê·¼ì„ í•˜ê²Œ ë˜ë©´ ë™ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

ì´ ì™¸ì—ë„ ë„ë©”ì¸ ê´€ì ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ê°€ í•œ ê°œë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ë³´ì¦í•˜ê³ ì í•  ë•Œ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•œë‹¤.

## ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì 

### 1. ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•˜ëŠ” ë§ì€ ì½”ë“œ í•„ìš”

ë©€í‹°ìŠ¤ë ˆë”© í™˜ê²½ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë™ì‹œì„± ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ syncronized í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì•¼í•œë‹¤.

### 2. í…ŒìŠ¤íŠ¸ì˜ ì–´ë ¤ì›€

ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ëŠ” ìì›ì„ ê³µìœ í•˜ê³  ìˆê¸°ì— í…ŒìŠ¤íŠ¸ê°€ ê²°ì •ì ìœ¼ë¡œ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ìˆ˜í–‰í•˜ë ¤ë©´ ë§¤ë²ˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì´ˆê¸°í™” ì‹œì¼œì£¼ì–´ì•¼ í•œë‹¤. ê·¸ë ‡ê²Œ í•˜ì§€ ì•Šìœ¼ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ìƒíƒœë¥¼ ê³µìœ í•˜ê¸°ì— í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ì´ ì˜¨ì „í•˜ì§€ ëª»í•˜ë‹¤.

### 3. ì˜ì¡´ ê´€ê³„ìƒ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´

new í‚¤ì›Œë“œë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ í´ë˜ìŠ¤ ì•ˆì—ì„œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ì´ëŠ” SOLID ì›ì¹™ ì¤‘ DIPë¥¼ ìœ„ë°˜í•˜ê²Œ ë˜ê³  OCP ì›ì¹™ ë˜í•œ ìœ„ë°˜í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.

> DIP(ì˜ì¡´ ê´€ê³„ ì—­ì „ ì›ì¹™, Dependency inversion principle)
- ì˜ì¡´ ê´€ê³„ë¥¼ ë§ºì„ ë•Œ, ë³€í™”í•˜ê¸° ì‰¬ìš´ ê²ƒë³´ë‹¨ ë³€í™”í•˜ê¸° ì–´ë ¤ìš´ ê²ƒì— ì˜ì¡´í•´ì•¼ í•œë‹¤.
> 

> OCP(ê°œë°©-íì‡„ ì›ì¹™, Open-Closed Principle)
- ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³ (Closed) ê¸°ëŠ¥ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡(Open) ì„¤ê³„í•´ì•¼ í•œë‹¤.
> 

### 4. ê·¸ ì™¸

ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ìœ¼ë©°, ë‚´ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•˜ê¸° ì–´ë ¤ì›€ì´ ìˆëŠ” ë“± ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œê°€ ì¡´ì¬í•œë‹¤.

ì¦‰, ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ ê°€ì§€ê³  ìˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì€ ìœ ì—°ì„±ì´ ë§ì´ ë–¨ì–´ì§€ëŠ” íŒ¨í„´ì´ë‹¤.

## ì˜ˆì œ - í”„ë¦°í„° ê´€ë¦¬ì ë§Œë“¤ê¸°

- í”„ë¦°í„° í•˜ë‚˜ë¥¼ ì—¬ëŸ¬ëª…ì´ ê³µìœ í•´ì„œ ì‚¬ìš©í•œë‹¤ ê°€ì •

```java
public class Printer {
	public Printer() { }
	public void print(Resource r) { ... }
}
```

- Printer í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ í”„ë¦°í„°ë¥¼ ì´ìš©í•˜ë ¤ë©´ Client í”„ë¡œê·¸ë¨ì—ì„œ new Printer()ê°€ ë°˜ë“œì‹œ í•œë²ˆë§Œ í˜¸ì¶œë˜ë„ë¡ í•´ì•¼í•œë‹¤. (í”„ë¦°í„°ëŠ” í•˜ë‚˜ì´ê¸°ì—)
- ì´ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì€ ìƒì„±ìë¥¼ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ì—†ê²Œ í•˜ëŠ” ê²ƒ
    - Printer í´ë˜ìŠ¤ ìƒì„±ìë¥¼ privateìœ¼ë¡œ ì„ ì–¸

```java
public class Printer {
	private Printer() { } // Printer ìƒì„±ìë¥¼ ì™¸ë¶€ì—ì„œ ì‚¬ìš© ë¶ˆê°€
	public void print(Resource r) { ... }
}
```

- ìê¸° ìì‹  í”„ë¦°í„°ì— ëŒ€í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ì™¸ë¶€ì— ì œê³µí•´ì¤„ ë©”ì„œë“œê°€ í•„ìš”í•˜ë‹¤.
    - static ë©”ì„œë“œ / static ë³€ìˆ˜
    - ë§Œì•½ new Printer()ê°€ í˜¸ì¶œë˜ê¸° ì „ì´ë©´ ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œì¸ print() ë©”ì„œë“œëŠ” í˜¸ì¶œí•  ìˆ˜ ì—†ë‹¤.

```java
public class Printer {
	// ì™¸ë¶€ì— ì œê³µí•  ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤
	private static Printer printer = null;
	private Printer() { }
	// ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì™¸ë¶€ì— ì œê³µ
	public static Printer getPrinter() {
		if (printer == null) {
			// Printer Instance ìƒì„±
			printer = new Printer();
		}
		return printer;
	}
	public void print(String str) {
		System.out.println(str);
	}
}
```

- Client

```java
public class User {
  private String name;
  public User(String name) { this.name = name; }
  public void print() {
    Printer printer = printer.getPrinter();
    printer.print(this.name + " print using " + printer.toString());
  }
}
public class Client {
  private static final int USER_NUM = 5;
  public static void main(String[] args) {
    User[] user = new User[USER_NUM];
    for (int i = 0; i < USER_NUM; i++) {
      // User ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
      user[i] = new User((i+1))
      user[i].print();
    }
  }
}
```

### ë¬¸ì œì 

**ë‹¤ì¤‘ ìŠ¤ë ˆë“œ**ì—ì„œ Printer í´ë˜ìŠ¤ë¥¼ ì´ìš©í•  ë•Œ ì¸ìŠ¤í„´ìŠ¤ê°€ 1ê°œ ì´ìƒ ìƒì„±ë˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

- **ê²½í•© ì¡°ê±´**(Race Condition)ì„ ë°œìƒì‹œí‚¤ëŠ” ê²½ìš°
    1. Printer ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ë•Œ ìŠ¤ë ˆë“œ 1ì´ getPrinter ë©”ì„œë“œì˜ ifë¬¸ì„ ì‹¤í–‰í•´ ì´ë¯¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤. í˜„ì¬ Printer ë³€ìˆ˜ëŠ” null.
    2. ìŠ¤ë ˆë“œ 1ì´ ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ì „ ìŠ¤ë ˆë“œ 2ê°€ ifë¬¸ì„ ì‹¤í–‰í•˜ì—¬ printer ë³€ìˆ˜ê°€ nullì¸ì§€ í™•ì¸í•œë‹¤. í˜„ì¬ printer ë³€ìˆ˜ëŠ” nullì´ë¯€ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.
    3. ìŠ¤ë ˆë“œ 1ë„ ìŠ¤ë ˆë“œ 2ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ë˜ë©´ ê²°ê³¼ì ìœ¼ë¡œ Printer í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ 2ê°œ ìƒì„±ëœë‹¤.

> ê²½í•© ì¡°ê±´(Race Condition) : ë©”ëª¨ë¦¬ì™€ ê°™ì€ ë™ì¼í•œ ìì›ì„ 2ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ì´ìš©í•˜ë ¤ê³  ê²½í•©í•˜ëŠ” í˜„ìƒ
> 

### í•´ê²°ì±…

ì‚¬ì‹¤ **ë‹¤ì¤‘ ìŠ¤ë ˆë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë‹Œ ê²½ìš° ì•„ë¬´ëŸ° ë¬¸ì œê°€ ì—†ë‹¤.**

- ì •ì  ë³€ìˆ˜ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë°”ë¡œ ì´ˆê¸°í™” í•˜ëŠ” ë°©ë²•(Eager Initialization)
- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œì— ë™ê¸°í™” í•˜ëŠ” ë°©ë²•(Thread-Safe Initialization)

1. Eager Initialization
    
    ```java
    public class Printer {
       // static ë³€ìˆ˜ì— ì™¸ë¶€ì— ì œê³µí•  ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì´ˆê¸°í™”
       private static Printer printer = new Printer();
       private Printer() { }
       // ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì™¸ë¶€ì— ì œê³µ
       public static Printer getPrinter(){
         return printer;
       }
       public void print(String str) {
         System.out.println(str);
       }
    }
    ```
    
    <aside>
    ğŸ’¡ static ë³€ìˆ˜ : ê°ì²´ê°€ ìƒì„±ë˜ê¸° ì „ í´ë˜ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ë¡œë”©ë  ë•Œ ë§Œë“¤ì–´ì ¸ ì´ˆê¸°í™”ê°€ í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤.
    
    </aside>
    
2. Thread-Safe Initialization
    
    ```java
    public class Printer {
       // ì™¸ë¶€ì— ì œê³µí•  ìê¸° ìì‹ ì˜ ì¸ìŠ¤í„´ìŠ¤
       private static Printer printer = null;
       private int counter = 0;
       private Printer() { }
       // ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œ ë™ê¸°í™” (ì„ê³„ êµ¬ì—­)
       public synchronized static Printer getPrinter(){
         if (printer == null) {
           printer = new Printer(); // Printer ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
         }
         return printer;
       }
       public void print(String str) {
         // ì˜¤ì§ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì ‘ê·¼ì„ í—ˆìš©í•¨ (ì„ê³„ êµ¬ì—­)
         // ì„±ëŠ¥ì„ ìœ„í•´ í•„ìš”í•œ ë¶€ë¶„ë§Œì„ ì„ê³„ êµ¬ì—­ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
         synchronized(this) {
           counter++;
           System.out.println(str + counter);
         }
       }
    }
    ```
    
    - ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œë¥¼ ì„ê³„ êµ¬ì—­ìœ¼ë¡œ ë³€ê²½
        - ë‹¤ì¤‘ ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë™ì‹œì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ getPrinter ë©”ì„œë“œë¥¼ ì†Œìœ í•˜ëŠ” ê°ì²´ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.
    - ê³µìœ  ë³€ìˆ˜ì— ì ‘ê·¼í•˜ëŠ” ë¶€ë¶„ì„ ì„ê³„ êµ¬ì—­ìœ¼ë¡œ ë³€ê²½
        - ì—¬ëŸ¬ ê°œì˜ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ë¿ì¸ counter ë³€ìˆ˜ ê°’ì— ë™ì‹œì— ì ‘ê·¼í•´ ê°±ì‹ í•˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.
    - getInstance()ì— Lockì„ í•˜ëŠ” ë°©ì‹ì´ë¼ ì†ë„ê°€ ëŠë¦¬ë‹¤.

## ê²°ë¡ 

ì˜¤ì§ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ì„ ë³´ì¦í•˜ì—¬ íš¨ìœ¨ì„ ì°¾ì„ ìˆ˜ ìˆì§€ë§Œ ê·¸ì— ëª»ì§€ì•Šê²Œ ë§ì´ ë”¸ë ¤ì˜¤ëŠ” ë¬¸ì œì ë„ ë§ë‹¤. ì‹±ê¸€í†¤ íŒ¨í„´ì€ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ë©´ ê°ì²´ ì§€í–¥ì— ìœ„ë°˜ë˜ëŠ” ì‚¬ë¡€ë“¤ì´ ë§ì§€ë§Œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ê°™ì€ í”„ë ˆì„ì›Œí¬ì˜ ë„ì›€ì„ ë°›ìœ¼ë©´ ë¬¸ì œì ì´ ë³´ì™„ë˜ë©´ì„œ ì¥ì ì˜ í˜œíƒì„ ëˆ„ë¦´ ìˆ˜ ìˆë‹¤.

ìœ„ì—ì„œ ì‚´í´ë³¸ ì‚¬ìš© ì‹œ ì¥ì ê³¼ ë¬¸ì œì ì„ trade-off í•˜ì—¬ ì˜ ê³ ë ¤í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

## ì°¸ì¡°

- [https://tecoble.techcourse.co.kr/post/2020-11-07-singleton/](https://tecoble.techcourse.co.kr/post/2020-11-07-singleton/)
- [https://gmlwjd9405.github.io/2018/07/06/singleton-pattern.html](https://gmlwjd9405.github.io/2018/07/06/singleton-pattern.html)
- [https://devmoony.tistory.com/43](https://devmoony.tistory.com/43)